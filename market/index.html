<!DOCTYPE html>
<html lang="en" class="arca-page">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Home â€” RANNTA ARCA</title>
  <meta name="description" content="Explore NFTs on RANNTA ARCA." />
  <meta name="theme-color" content="#0f0f11" />
  <link rel="icon" href="assets/rannta-arca1.png" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="preload" as="script" href="assets/tonconnect-ui.min.js" />
  <link rel="stylesheet" href="assets/marketplace.css" />
</head>
<body data-page="home">
  <header class="header">
    <div class="wrap header-grid">
      <div class="left">
        <a class="brand" href="index.html">
          <img class="logo" src="assets/rannta-arca1.png" alt="RANNTA ARCA" />
          <span class="brand-text">RANNTA ARCA</span>
        </a>
        <nav class="nav">
          <a href="index.html">Explore</a>
          <a href="collection.html">Collections</a>
          <a href="create.html">Create</a>
          <a id="nav-profile" href="profile.html">Profile</a>
        </nav>
      </div>
      <div class="middle">
        <!-- optional global search slot -->
      </div>
      <div class="actions" id="actions">
        <button id="btn-swap" class="btn secondary btn-small">â‡„ Swap</button>
        <button id="btn-connect" class="btn btn-small">ðŸ”— Connect</button>
        <div class="connect" id="tonconnect" aria-hidden="true"></div>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Collect, Create & Trade â€” on TON</h1>
      <p>Lightweight, non-custodial NFT marketplace with TonConnect.</p>
    </section>

    <div class="toolbar">
      <input id="search" class="search" type="search" placeholder="Search by name or collectionâ€¦">
      <div class="right">
        <select id="sort" class="select" aria-label="Sort">
          <option value="">No sorting</option>
          <option value="price-asc">Price â†‘</option>
          <option value="price-desc">Price â†“</option>
          <option value="name">Alphabetical</option>
        </select>
      </div>
    </div>

    <section id="grid" class="grid" aria-live="polite"></section>
  </main>

  <footer class="footer">Â© 2025 RANNTA ARCA â€” All rights reserved.</footer>

  <!-- TonConnect UI (local asset) -->
  <script src="assets/tonconnect-ui.min.js"></script>

  <!-- Your existing app script -->
  <script src="assets/app.js"></script>

  <!-- Service worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/market/service-worker.js', { scope: '/market/' })
          .catch(console.error);
      });
    }
  </script>

  <!-- TonConnect wiring for existing Connect button -->
  <script>
    (function () {
      const MANIFEST_URL = '/market/tonconnect-manifest.json';

      // Initialize TonConnect (no auto-rendered button; we bind to your own button)
      const tcui = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: MANIFEST_URL,
        uiPreferences: { theme: 'SYSTEM' }
      });

      const connectBtn = document.getElementById('btn-connect');
      const profileLink = document.getElementById('nav-profile');

      // Click handler: connect if disconnected, disconnect if connected
      connectBtn.addEventListener('click', async () => {
        try {
          const wallet = await tcui.getWallet();
          if (wallet) {
            await tcui.disconnect();
          } else {
            await tcui.connectWallet();
          }
        } catch (err) {
          console.error('TonConnect error:', err);
        }
      });

      // Update UI on status change
      tcui.onStatusChange((walletInfo) => {
        if (walletInfo && walletInfo.account) {
          const addr = walletInfo.account.address;
          const short = `${addr.slice(0, 4)}â€¦${addr.slice(-4)}`;
          connectBtn.textContent = short;
          connectBtn.classList.add('connected');
          if (profileLink) {
            profileLink.textContent = `Profile (${short})`;
            profileLink.classList.add('connected');
          }
        } else {
          connectBtn.textContent = 'ðŸ”— Connect';
          connectBtn.classList.remove('connected');
          if (profileLink) {
            profileLink.textContent = 'Profile';
            profileLink.classList.remove('connected');
          }
        }
      });

      // Restore previous session on reload
      tcui.restoreConnection();

      // Expose for other scripts (e.g., buy buttons)
      window.__tonconnect = tcui;
    })();
  </script>
</body>
</html>
